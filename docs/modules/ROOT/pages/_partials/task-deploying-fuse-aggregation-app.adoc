// Module included in the following assemblies:
//
// <List assemblies here, each on a new line>

// Base the file name and the ID on the module title. For example:
// * file name: doing-procedure-a.adoc
// * ID: [id='doing-procedure-a']
// * Title: = Doing procedure A

// The ID is used as an anchor for linking to the module. Avoid changing it after the module has been published to ensure existing links are not broken.
[id='deploying-fuse-aggregation-app_{context}']
// The `context` attribute enables module reuse. Every module's ID includes {context}, which ensures that the module has a unique ID even if it is reused multiple times in a guide.



= Deploying the Fuse Aggregation App

ifdef::location[]
// tag::intro[]
The Fuse Aggregation App can be deployed using Launcher.
// end::intro[]
endif::location[]

// TODO placeholders for product names
// TODO append /launch/wizard/<project-name> to launcher url
// TODO flights endpoint url
. Log in to the link:{launcher-url}/launch/wizard/{walkthrough-namespace}[{launcher-service}, window="_blank"] wizard.

. Select the option to *Code Locally, Build and Deploy* in the *Select Target Environment* step

. Select the *Authorize* button to allow Launcher create resources in the OpenShift cluster. This triggers an OAuth flow, and eventually redirects back to the {launcher-service} wizard.

. Select the blue down-arrow icon to continue the wizard

. Select the *Aggregation* mission and *Fuse* runtime in the *Select Mission & Runtime* step

. Select the blue down-arrow icon to continue the wizard

. Authorize your Github Account
.. Select the *Log In & Authorize Account* button in the *Authorize Git Provider* step.
.. This opens a Github OAuth page.
.. Select the *Authorize <organisation/user>* button at the bottom
.. You will be redirected back to the {launcher-service} wizard.

. Select all blue down-arrow icons to continue the wizard, accepting the git repository name.

. Select the *Set Up Application* button to create a Git repository and provision the mission resources to OpenShift. A build for the *Fuse Aggregation App* will be triggered, and a deployment eventually rolled out.


ifdef::location[]

.Verification
// tag::verification[]
The link:{openshift-host}/console/project/{walkthrough-namespace}[Project, window="_blank"] in OpenShift has the following running pods:

. fuse-flights-aggregator

. arrivals

. departures

// TODO: flights api links to /camel/flights
The link:https://{fuse-aggregator-url}/camel/flights[Flights Endpoint, window="_blank"] can be reached and responds with 8 flights.

// end::verification[]
endif::location[]

ifdef::location[]

.VerificationNo
// tag::verificationNo[]
Retry the *Deploying the Fuse Aggregation App* procedure. If this still doesn't work, visit link:{fuse-aggregator-url}[this link, window="_blank"] to find additional help.
// end::verificationNo[]
endif::location[]
